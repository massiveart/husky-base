<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>/Users/marcelmoosbrugger/Development/husky-base/src/components/cm/column-navigation/main.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title=""></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/AutoComplete.html">AutoComplete</a></li>
            
                <li><a href="../classes/AutoCompleteList.html">AutoCompleteList</a></li>
            
                <li><a href="../classes/base.html">base</a></li>
            
                <li><a href="../classes/CKEditor.html">CKEditor</a></li>
            
                <li><a href="../classes/Column-Options.html">Column-Options</a></li>
            
                <li><a href="../classes/ColumnNavigation.html">ColumnNavigation</a></li>
            
                <li><a href="../classes/Component.html">Component</a></li>
            
                <li><a href="../classes/DataGrid.html">DataGrid</a></li>
            
                <li><a href="../classes/Dependant Select.html">Dependant Select</a></li>
            
                <li><a href="../classes/DropdownPagination (Datagrid Decorator).html">DropdownPagination (Datagrid Decorator)</a></li>
            
                <li><a href="../classes/Dropzone.html">Dropzone</a></li>
            
                <li><a href="../classes/ExtensionManager.html">ExtensionManager</a></li>
            
                <li><a href="../classes/Husky.html">Husky</a></li>
            
                <li><a href="../classes/Label.html">Label</a></li>
            
                <li><a href="../classes/Loader.html">Loader</a></li>
            
                <li><a href="../classes/Logger.html">Logger</a></li>
            
                <li><a href="../classes/Overlay.html">Overlay</a></li>
            
                <li><a href="../classes/Sandbox.html">Sandbox</a></li>
            
                <li><a href="../classes/Search.html">Search</a></li>
            
                <li><a href="../classes/Select.html">Select</a></li>
            
                <li><a href="../classes/ShowAllPagination (Datagrid Decorator).html">ShowAllPagination (Datagrid Decorator)</a></li>
            
                <li><a href="../classes/TableView (Datagrid Decorator).html">TableView (Datagrid Decorator)</a></li>
            
                <li><a href="../classes/Tabs.html">Tabs</a></li>
            
                <li><a href="../classes/ThumbnailView (Datagrid Decorator).html">ThumbnailView (Datagrid Decorator)</a></li>
            
                <li><a href="../classes/Toggler.html">Toggler</a></li>
            
                <li><a href="../classes/Toolbar.html">Toolbar</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/husky.html">husky</a></li>
            
                <li><a href="../modules/husky_components.html">husky/components</a></li>
            
                <li><a href="../modules/husky_components_auto-complete.html">husky/components/auto-complete</a></li>
            
                <li><a href="../modules/husky_components_auto-complete-list.html">husky/components/auto-complete-list</a></li>
            
                <li><a href="../modules/husky_components_column-navigation.html">husky/components/column-navigation</a></li>
            
                <li><a href="../modules/husky_components_column-options.html">husky/components/column-options</a></li>
            
                <li><a href="../modules/husky_components_dropzone.html">husky/components/dropzone</a></li>
            
                <li><a href="../modules/husky_components_label.html">husky/components/label</a></li>
            
                <li><a href="../modules/husky_components_overlay.html">husky/components/overlay</a></li>
            
                <li><a href="../modules/husky_components_process.html">husky/components/process</a></li>
            
                <li><a href="../modules/husky_components_toolbar.html">husky/components/toolbar</a></li>
            
                <li><a href="../modules/husky_extensions.html">husky/extensions</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: /Users/marcelmoosbrugger/Development/husky-base/src/components/cm/column-navigation/main.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
 * This file is part of Husky frontend development framework.
 *
 * (c) MASSIVE ART WebServices GmbH
 *
 * This source file is subject to the MIT license that is bundled
 * with this source code in the file LICENSE.
 *
 * @module husky/components/column-navigation
 */


/**
 * @class ColumnNavigation
 * @constructor
 *
 * @params {Object} [options] Configuration object
 * @params {Number} [options.wrapper.height] height of container in percentage
 * @params {Number} [options.column.width] width of a column in within the navigation in pixels
 * @params {Number} [options.scrollBarWidth] with of scrollbar
 * @params {String} [options.url] url to load data
 * @params {String} [options.selected] id of selected element - needed to restore state
 * @params {String} [options.editIcon] icon class of edit button
 * @params {Array}  [options.data] array of data displayed in the settings dropdown
 * @params {String} [options.instanceName] name of current instance
 * @params {String} [options.hasSubName] name of hasSub-key
 * @params {String} [options.idName] name of id-key
 * @params {String} [options.linkedName] name of linked-key
 * @params {String} [options.publishedName] name of published-key
 * @params {String} [options.typeName] name of type-key
 * @params {String} [options.titleName] name of title-key
 * @params {Number} [options.visibleRatio] minimum ratio of how much of a column must be visible to display the navigation
 * @params {String} [options.sizeRelativeTo] dom object which is used to calculate height / width (default $window)
 * @params {Boolean} [options.showEdit] hide or display edit elements
 * @params {Boolean} [options.showEditIcon] hide or display edit icon element
 * @params {Boolean} [options.showStatus] hide or display status of elements
 */
define([], function() {

    &#x27;use strict&#x27;;

    var defaults = {
            wrapper: {
                height: 70
            },
            column: {
                width: 250
            },
            paddingLeft: 50,
            url: null,
            selected: null,
            data: null,
            instanceName: &#x27;undefined&#x27;,
            hasSubName: &#x27;hasSub&#x27;,
            editIcon: &#x27;fa-pencil&#x27;,
            idName: &#x27;id&#x27;,
            pathName: &#x27;path&#x27;,
            linkedName: &#x27;linked&#x27;,
            publishedName: &#x27;publishedState&#x27;,
            titleName: &#x27;title&#x27;,
            typeName: &#x27;type&#x27;,
            minVisibleRatio: 1 / 2,
            noPageDescription: &#x27;public.no-pages&#x27;,
            sizeRelativeTo: null,
            showEdit: true,
            showEditIcon: true,
            showStatus: true
        },

        DISPLAYEDCOLUMNS = 2, // number of displayed columns with content

        /**
         * namespace for events
         * @type {string}
         */
        eventNamespace = &#x27;husky.column-navigation.&#x27;,

        /**
         * @event husky.column-navigation.loaded
         * @description the component has loaded everything successfully and will be rendered
         */
        LOADED = eventNamespace + &#x27;loaded&#x27;,

        /**
         * @event husky.column-navigation.selected
         * @description an navigation element has been selected
         * @param {Object} selected object
         */
        SELECTED = eventNamespace + &#x27;selected&#x27;,

        /**
         * @event husky.column-navigation.settings
         * @description an navigation element has been selected and a item from selected dropdown clicked
         * @param {Object} selected column navigation object
         * @param {Object} clicked dropdown item
         */
        SETTINGS = eventNamespace + &#x27;settings&#x27;,

        /**
         * @event husky.column-navigation.add
         * @description the add button has been clicked
         * @param {Object} parent object from active column level
         */
        ADD = eventNamespace + &#x27;add&#x27;,

        /**
         * @event husky.column-navigation.edit
         * @description the edit icon has been clicked
         * @param {Object} clicked object
         */
        EDIT = eventNamespace + &#x27;edit&#x27;,

        /**
         * @event husky.column-navigation.get-breadcrumb
         * @description the breadcrumb will be returned
         * @param {Function} callback function which will process the breadcrumb objects
         */
        BREADCRUMB = eventNamespace + &#x27;get-breadcrumb&#x27;,

        /**
         * @event husky.column-navigation.resize
         * @description the element will be resized
         * @param {Function} callback function which will process the breadcrumb objects
         */
        RESIZE = eventNamespace + &#x27;resize&#x27;;

    return {

        initialize: function() {
            this.options = this.sandbox.util.extend(true, {}, defaults, this.options);

            // default relative
            this.options.sizeRelativeTo = this.options.sizeRelativeTo || this.sandbox.dom.$window;

            this.$element = this.sandbox.dom.$(this.options.el);
            this.$selectedElement = null;
            this.$addColumn = null;
            this.filledColumns = 0;
            this.columnLoadStarted = false;
            this.$loader = null;
            this.$bigLoader = null;

            this.columns = [];
            this.selected = [];

            this.render();
            this.startBigLoader();
            this.load(this.options.url, 0);
            this.bindDOMEvents();
            this.bindCustomEvents();
        },

        /**
         * Renders basic structure (wrapper) of column navigation
         */
        render: function() {
            var $add, $settings, $wrapper;

            $wrapper = this.sandbox.dom.$(this.template.wrapper.call(this));
            this.sandbox.dom.append(this.$element, $wrapper);

            // navigation container

            this.$columnContainer = this.sandbox.dom.$(this.template.columnContainer.call(this));
            this.setContainerHeight();
            this.sandbox.dom.append($wrapper, this.$columnContainer);

            // options container - add and settings button
            this.addId = this.options.instanceName + &quot;-column-navigation-add&quot;;
            this.settingsId = this.options.instanceName + &quot;-column-navigation-settings&quot;;

            if (!!this.options.showEdit) {
                this.$optionsContainer = this.sandbox.dom.$(this.template.optionsContainer.call(this, this.options.column.width));
                $add = this.sandbox.dom.$(this.template.options.add(this.addId));
                $settings = this.sandbox.dom.$(this.template.options.settings(this.settingsId));
                this.sandbox.dom.append(this.$optionsContainer, $add);
                this.sandbox.dom.append(this.$optionsContainer, $settings);
                this.hideOptions();
                this.sandbox.dom.append($wrapper, this.$optionsContainer);
            }

            this.setContainerHeight();
            this.setContainerMinWidth();

            //init dropdown for settings in options container
            if (!!this.options.data) {
                this.initSettingsDropdown(this.sandbox.dom.attr($settings, &#x27;id&#x27;));
            }

        },

        /**
         * Starts the big loader, before loading content during the initialization
         */
        startBigLoader: function() {
            if (this.$bigLoader === null) {
                this.$bigLoader = this.sandbox.dom.createElement(&#x27;&lt;div class=&quot;column-navigation-loader&quot;/&gt;&#x27;);
                this.sandbox.dom.hide(this.$bigLoader);
                this.sandbox.dom.html(this.$columnContainer, this.$bigLoader);

                this.sandbox.start([
                    {
                        name: &#x27;loader&#x27;,
                        options: {
                            el: this.$bigLoader,
                            size: &#x27;100px&#x27;,
                            color: &#x27;#e4e4e4&#x27;
                        }
                    }
                ]);
            }
            this.sandbox.dom.show(this.$bigLoader);
        },

        /**
         * Detatches the big loader from the column-navigation
         */
        removeBigLoader: function() {
            this.sandbox.dom.hide(this.$find(&#x27;.column-navigation-loader&#x27;));
        },

        /**
         * Sets the height of the container
         */
        setContainerHeight: function() {
            var height = this.sandbox.dom.height(this.options.sizeRelativeTo),
                top = this.sandbox.dom.offset(this.$el).top - (this.options.sizeRelativeTo !== this.sandbox.dom.$window ? this.sandbox.dom.offset(this.options.sizeRelativeTo).top : 0);
            top = top &lt; 0 ? 0 : top;

            this.sandbox.dom.height(
                this.$columnContainer, (height - top) * this.options.wrapper.height / 100
            );
        },

        /**
         * Instantiats the dropdown component
         * @param containerId dom id for element to start dropdown
         */
        initSettingsDropdown: function(containerId) {

            // TODO show dropdown only if item is selected and enable/disable certain elements of the dropdown depending on the selected element

            this.sandbox.start([
                {
                    name: &#x27;dropdown&#x27;,
                    options: {
                        el: &#x27;#&#x27; + containerId,
                        setParentDropDown: true,
                        instanceName: this.options.instanceName + &#x27;.settings.dropdown&#x27;,
                        alignment: &#x27;left&#x27;,
                        data: this.options.data
                    }
                }
            ]);
        },

        /**
         * Loads data from a specific url and triggers the parsing
         * @param {String} url
         * @param {Number} columnNumber
         */
        load: function(url, columnNumber) {
            if (!!url) {
                this.columnLoadStarted = true;
                this.sandbox.util.load(url)
                    .then(function(response) {
                        this.removeBigLoader();
                        this.columnLoadStarted = false;
                        this.parseData(response, columnNumber);
                        this.handleLastEmptyColumn();
                        this.alignWithColumnsWidth();
                        this.scrollIfNeeded(this.filledColumns + 1);
                        this.setOverflowClass();
                        this.showOptionsAtLast();
                        this.sandbox.emit(LOADED);
                    }.bind(this))
                    .fail(function(error) {
                        this.columnLoadStarted = false;
                        this.sandbox.logger.error(&quot;An error occured while fetching data from: &quot;, error);
                    }.bind(this));

            } else {
                this.sandbox.logger.log(&quot;husky.column.navigation -  url not set, aborted loading of data&quot;);
            }
        },

        /**
         * Removes removes data and removes dom elements
         * @param {Number} newColumn
         */
        removeColumns: function(newColumn) {

            // removes all old columns except of next after clicked
            // next column after clicked will be emptied and used again
            var length = this.filledColumns + 1,
                i, tmp;

            for (i = length; i &gt; newColumn; i--) {
                delete this.columns[i];
                this.sandbox.dom.remove(&#x27;#column-&#x27; + i);
                this.filledColumns--;
            }

            // check if element in dom exists
            tmp = this.sandbox.dom.find(&#x27;#column-&#x27; + newColumn);
            if (tmp.length === 1) {
                this.$addColumn = tmp[0];
            }

            this.sandbox.dom.remove(&#x27;#column-&#x27; + newColumn + &#x27; li&#x27;);

        },

        /**
         * Parses the received data and renders columns
         * @param {String} data
         * @param {Number} columnNumber
         */
        parseData: function(data, columnNumber) {
            var $column, $list, newColumn, nodeWithSubNodes = null, lastSelected = null;

            if (columnNumber === 0) {  // case 1: no elements in container
                this.columns[0] = [];
                this.columns[0][data[this.options.idName]] = data;
                newColumn = 1;
            } else { // case 2: columns in container replace level after clicked column and clear following levels
                newColumn = columnNumber + 1;
            }

            $column = this.getDOMColumn(newColumn);
            this.sandbox.dom.append(this.$columnContainer, $column);

            $list = this.sandbox.dom.find(&#x27;ul&#x27;, $column);

            this.sandbox.util.each(data._embedded, function(value, index) {

                this.storeDataItem(newColumn, value);
                var $element = this.sandbox.dom.$(this.template.item.call(this, this.options.column.width, value));
                this.sandbox.dom.append($list, $element);

                this.setItemsTextWidth($element);

                // remember which item has subitems to display a whole tree when column navigation should be restored
                if (!!value[this.options.hasSubName] &amp;&amp; value._embedded.length &gt; 0) {
                    nodeWithSubNodes = value;
                    this.setElementSelected($element);
                    this.selected[newColumn] = value;
                }

                // needed to select node in last level of nodes
                if (!!this.options.selected &amp;&amp; (this.options.selected === value[this.options.idName] || this.options.selected === value[this.options.pathName])) {
                    this.setElementSelected($element);
                    this.selected[newColumn] = value;
                    lastSelected = value;
                }

            }.bind(this));

            this.removeLoadingIconForSelected();

            this.filledColumns++;


            if (!!nodeWithSubNodes) { // parse next column if data exists
                this.parseData(nodeWithSubNodes, newColumn);
            } else if (!!lastSelected &amp;&amp; !lastSelected[this.options.hasSubName]) { // append add column if no children
                this.insertAddColumn(lastSelected, newColumn);
            }

        },

        /**
         * Sets the width of the text-container of an item
         * @param {Object} $item the dom-object of an item
         */
        setItemsTextWidth: function($item) {
            var width, $itemText;

            $itemText = this.sandbox.dom.find(&#x27;.item-text&#x27;, $item);
            width = this.options.column.width - this.sandbox.dom.outerWidth(this.sandbox.dom.find(&#x27;.icons-left&#x27;, $item));
            width = width - parseInt(this.sandbox.dom.css($item, &#x27;padding-right&#x27;).replace(&#x27;px&#x27;, &#x27;&#x27;)) - 2;
            width = width - parseInt(this.sandbox.dom.css($item, &#x27;padding-left&#x27;).replace(&#x27;px&#x27;, &#x27;&#x27;));
            width = width - this.sandbox.dom.outerWidth(this.sandbox.dom.find(&#x27;.icons-right&#x27;, $item));

            this.sandbox.dom.width($itemText, width);
            this.cropItemsText($itemText);
        },

        /**
         * Crops the item text of an item depending on its width
         * @param $itemText {Object}
         */
        cropItemsText: function($itemText) {
            var title = this.sandbox.dom.attr($itemText, &#x27;title&#x27;),
                croppedTitle,
                maxLength = title.length,
                overflow;

            //set the item text to the original title
            this.sandbox.dom.html($itemText, title);

            overflow = (this.sandbox.dom.get($itemText, 0).scrollWidth &gt; this.sandbox.dom.width($itemText));

            while (overflow === true) {
                maxLength = maxLength - 1;
                croppedTitle = this.sandbox.util.cropMiddle(title, maxLength);
                this.sandbox.dom.html($itemText, croppedTitle);
                overflow = (this.sandbox.dom.get($itemText, 0).scrollWidth &gt; this.sandbox.dom.width($itemText));
            }
        },

        /**
         * Sets/removes all needed classes to display a node as selected
         * @param $element
         */
        setElementSelected: function($element) {
            this.sandbox.dom.addClass($element, &#x27;selected&#x27;);
            var $arrowElement = this.sandbox.dom.find(&#x27;.arrow&#x27;, $element);
            this.sandbox.dom.removeClass($arrowElement, &#x27;inactive&#x27;);
        },

        /**
         * Returns column to put the node elements in
         * @param newColumn number of new column
         * @returns {Object} DOM column
         */
        getDOMColumn: function(newColumn) {
            var $column;

            if (!!this.$addColumn) { // take existing add-column
                $column = this.$addColumn;
                this.sandbox.dom.data(this.$addColumn, &#x27;id&#x27;, newColumn);
                this.sandbox.dom.attr(this.$addColumn, &#x27;id&#x27;, &#x27;column-&#x27; + newColumn);
                this.$addColumn = null;
            } else { // create new column
                $column = this.sandbox.dom.$(this.template.column.call(this, newColumn, this.options.column.width));
            }

            return $column;
        },

        /**
         * Adds the loading icon to a contianer
         * @param $container
         */
        addLoadingIcon: function($container) {
            this.sandbox.dom.removeClass($container, &#x27;fa-chevron-right inactive&#x27;);

            if (this.$loader === null) {
                this.$loader = this.sandbox.dom.createElement(&#x27;&lt;div class=&quot;husky-column-navigation-loader&quot;/&gt;&#x27;);
                this.sandbox.dom.hide(this.$loader);

                this.sandbox.start([
                    {
                        name: &#x27;loader&#x27;,
                        options: {
                            el: this.$loader,
                            size: &#x27;16px&#x27;,
                            color: &#x27;#666666&#x27;
                        }
                    }
                ]);
            }
            this.sandbox.dom.detach(this.$loader);
            this.sandbox.dom.html($container, this.$loader);
            this.sandbox.dom.show(this.$loader);
        },

        /**
         * Removes loading icon from selected element
         */
        removeLoadingIconForSelected: function() {
            if (!!this.$selectedElement) {
                var $arrow = this.sandbox.dom.find(&#x27;.arrow&#x27;, this.$selectedElement);
                this.sandbox.dom.hide(this.$loader);
                this.sandbox.dom.prependClass($arrow, &#x27;fa-chevron-right&#x27;);
            }
        },

        /**
         * Stores data in internal structure - seperated by column number
         * @param {Object} item
         * @param {Number} columnNumber
         */
        storeDataItem: function(columnNumber, item) {

            if (!this.columns[columnNumber]) {
                this.columns[columnNumber] = [];
            }
            this.columns[columnNumber][item[this.options.idName]] = item;

        },

        bindDOMEvents: function() {
            this.sandbox.dom.on(this.$el, &#x27;click&#x27;, this.itemSelected.bind(this), &#x27;li&#x27;);

            this.sandbox.dom.on(this.$el, &#x27;mouseenter&#x27;, this.itemMouseEnter.bind(this), &#x27;li&#x27;);
            this.sandbox.dom.on(this.$el, &#x27;mouseleave&#x27;, this.itemMouseLeave.bind(this), &#x27;li&#x27;);

            this.sandbox.dom.on(this.$el, &#x27;mouseenter&#x27;, this.showOptions.bind(this), &#x27;.column&#x27;);
            this.sandbox.dom.on(this.$el, &#x27;click&#x27;, this.addNode.bind(this), &#x27;#&#x27; + this.addId);
            this.sandbox.dom.on(this.$el, &#x27;click&#x27;, this.editNode.bind(this), &#x27;.edit&#x27;);
            this.sandbox.dom.on(this.$el, &#x27;dblclick&#x27;, this.editNode.bind(this), &#x27;li&#x27;);

            this.sandbox.dom.on(this.sandbox.dom.$window, &#x27;resize&#x27;, function() {
                this.setContainerHeight();
                this.setContainerMaxWidth();
                this.setOverflowClass();
            }.bind(this));
        },

        /**
         * Sets an overflow-class to the container if the navigation is scrollable
         */
        setOverflowClass: function() {
            var $navigation = this.sandbox.dom.find(&#x27;.column-navigation&#x27;, this.$el);
            if (this.sandbox.dom.width($navigation) &lt; this.sandbox.dom.get($navigation, 0).scrollWidth) {
                this.sandbox.dom.addClass($navigation, &#x27;overflow&#x27;);
            } else {
                this.sandbox.dom.removeClass($navigation, &#x27;overflow&#x27;);
            }
        },

        /**
         * Inserts some markup into the last column if column is empty
         */
        handleLastEmptyColumn: function() {
            var $lastColumn = this.sandbox.dom.last(this.sandbox.dom.find(&#x27;.column&#x27;, this.$columnContainer));

            this.sandbox.dom.remove(this.sandbox.dom.find(&#x27;.no-page&#x27;, this.$columnContainer));

            // if last column is empty insert markup
            if (this.sandbox.dom.find(&#x27;li&#x27;, $lastColumn).length === 0) {
                this.sandbox.dom.append($lastColumn, this.template.noPage.call(this, this.sandbox.translate(this.options.noPageDescription)));
            }
        },

        bindCustomEvents: function() {
            this.sandbox.on(BREADCRUMB, this.getBreadCrumb.bind(this));

            this.sandbox.on(&#x27;husky.dropdown.&#x27; + this.options.instanceName + &#x27;.settings.dropdown.item.click&#x27;, this.dropdownItemClicked.bind(this));

            this.sandbox.on(RESIZE, function() {
                this.setContainerHeight();
                this.setContainerMaxWidth();
                this.setOverflowClass();
            }.bind(this));
        },

        dropdownItemClicked: function(item) {
            if (!!this.selected[this.lastHoveredColumn]) {
                if (!!item.callback) {
                    item.callback(item, this.selected[this.lastHoveredColumn]);
                } else {
                    this.sandbox.emit(SETTINGS, item, this.selected[this.lastHoveredColumn]);
                }
            }
        },

        /**
         * Sets the text width
         * @param {Object} event
         */
        itemMouseEnter: function(event) {
            this.setItemsTextWidth(event.currentTarget);
        },

        /**
         * Sets the text width
         * @param {Object} event
         */
        itemMouseLeave: function(event) {
            this.setItemsTextWidth(event.currentTarget);
        },

        /**
         * Returns the breadcrumb
         * @param {Function} callback
         */
        getBreadCrumb: function(callback) {
            if (typeof callback === &#x27;function&#x27;) {
                callback(this.selected);
            } else {
                this.sandbox.logger.log(&quot;callback is not a function&quot;);
            }
        },

        /**
         * Shows the options at the last available column
         */
        showOptionsAtLast: function() {
            var $lastColumn = this.sandbox.dom.last(this.sandbox.dom.find(&#x27;.column&#x27;, this.$columnContainer));
            this.showOptions({
                currentTarget: $lastColumn
            });
        },

        /**
         * Shows the options below the last hovered column
         * @param {Object} event
         */
        showOptions: function(event) {
            var $currentTarget = this.sandbox.dom.$(event.currentTarget);

            this.displayOptions($currentTarget);

            this.sandbox.dom.off(this.$columnContainer, &#x27;scroll.column-navigation.&#x27; + this.options.instanceName);
            this.sandbox.dom.on(this.$columnContainer, &#x27;scroll.column-navigation.&#x27; + this.options.instanceName, this.displayOptions.bind(this, $currentTarget));
        },

        /**
         * Displays the options-navigation under a given column
         * @param $activeColumn {object} column for which the options will be inserted
         */
        displayOptions: function($activeColumn) {
            var visibleRatio;

            this.lastHoveredColumn = this.sandbox.dom.data($activeColumn, &#x27;column&#x27;);

            // calculate the ratio of how much of the hovered column is visible
            if (this.sandbox.dom.position($activeColumn).left + this.sandbox.dom.width($activeColumn) &gt; this.sandbox.dom.width(this.$columnContainer)) {
                visibleRatio = (this.sandbox.dom.width(this.$columnContainer) - this.sandbox.dom.position($activeColumn).left ) / this.sandbox.dom.width($activeColumn);
            } else {
                visibleRatio = (this.sandbox.dom.width($activeColumn) + this.sandbox.dom.position($activeColumn).left) / this.sandbox.dom.width($activeColumn);
            }

            // display the option only if the column is visible enough
            if (visibleRatio &gt;= this.options.minVisibleRatio) {
                this.sandbox.dom.css(this.$optionsContainer, {&#x27;visibility&#x27;: &#x27;visible&#x27;});
                this.updateOptionsMargin($activeColumn);
            } else {
                this.hideOptions();
            }
        },

        /**
         * Updates the position of the options
         * @param $activeColumn {object} dom-object of active column
         */
        updateOptionsMargin: function($activeColumn) {
            var marginLeft = this.sandbox.dom.position($activeColumn).left - 1;
            this.sandbox.dom.css(this.$optionsContainer, &#x27;margin-left&#x27;, marginLeft + &#x27;px&#x27;);
        },

        /**
         * Hides options
         */
        hideOptions: function() {
            this.sandbox.dom.css(this.$optionsContainer, {&#x27;visibility&#x27;: &#x27;hidden&#x27;});
        },

        /**
         * Item was selected and data will be loaded if has sub
         * @param {Object} event
         */
        itemSelected: function(event) {
            //only do something if no column is loading
            if (this.columnLoadStarted === false) {
                this.$selectedElement = this.sandbox.dom.$(event.currentTarget);
                var id = this.sandbox.dom.data(this.$selectedElement, &#x27;id&#x27;),
                    column = this.sandbox.dom.data(this.sandbox.dom.parent(this.sandbox.dom.parent(this.$selectedElement)), &#x27;column&#x27;),
                    selectedItem = this.columns[column][id],
                    length = this.selected.length - 1,
                    i, $arrowElement;


                if (this.sandbox.dom.hasClass(this.$selectedElement, &#x27;selected&#x27;)) { // is element already selected

                    this.sandbox.emit(SELECTED, selectedItem);

                } else { // element not selected

                    this.removeCurrentSelected(column);

                    this.sandbox.dom.addClass(this.$selectedElement, &#x27;selected&#x27;);
                    $arrowElement = this.sandbox.dom.find(&#x27;.arrow&#x27;, this.$selectedElement);
                    this.addLoadingIcon($arrowElement);

                    if (!!selectedItem) {

                        // remove old elements from breadcrumb
                        for (i = length; i &gt;= column; i--) {
                            delete this.selected[i];
                        }

                        // add element to breadcrumb
                        this.selected[column] = selectedItem;
                        this.sandbox.emit(SELECTED, selectedItem);

                        if (!!selectedItem[this.options.hasSubName]) {
                            this.load(selectedItem._links.children, column);
                        }

                        this.removeColumns(column + 1);
                    }
                }
                // insert add column when clicked element
                this.insertAddColumn(selectedItem, column);

                // scroll for add column
                if (!selectedItem.hasSub) {
                    this.handleLastEmptyColumn();
                    this.alignWithColumnsWidth();
                    this.scrollIfNeeded(column);
                    this.setOverflowClass();
                }
            }

        },

        /**
         * Sets the width of the container equal to the width of its columns
         */
        alignWithColumnsWidth: function() {
            var $columnNavi = this.sandbox.dom.find(&#x27;.column-navigation&#x27;, this.$el);
            this.setContainerMaxWidth();

            this.sandbox.dom.width(this.$el, this.sandbox.dom.find(&#x27;.column&#x27;, $columnNavi).length * this.options.column.width);
        },

        /**
         * Sets the max width of the container
         */
        setContainerMaxWidth: function() {
            var width = this.sandbox.dom.width(this.options.sizeRelativeTo),
                left = (this.options.sizeRelativeTo === this.sandbox.dom.$window ? this.sandbox.dom.offset(this.$el).left : 0);


            this.sandbox.dom.css(this.$el, {
                &#x27;max-width&#x27;: width - left - this.options.paddingLeft + &#x27;px&#x27;
            });
        },

        /**
         * Sets the min-width of the container
         */
        setContainerMinWidth: function() {
            this.sandbox.dom.css(this.$el, {&#x27;min-width&#x27;: &#x27;100%&#x27;});
        },

        insertAddColumn: function(selectedItem, column) {
            if (!this.$addColumn &amp;&amp; !selectedItem[this.options.hasSubName]) {
                // append empty column to add subpages
                this.$addColumn = this.sandbox.dom.createElement(this.template.column.call(this, column + 1, this.options.column.width));
                this.sandbox.dom.append(this.$columnContainer, this.$addColumn);
            }
        },

        /**
         * Scrolls if needed
         * @param column
         */
        scrollIfNeeded: function(column) {
            if (column &gt; DISPLAYEDCOLUMNS) {
                this.sandbox.dom.scrollLeft(this.$columnContainer, (column - DISPLAYEDCOLUMNS) * this.options.column.width);
            }
        },

        /**
         * Removes the selected class from old elements
         * @param {Number} column
         */
        removeCurrentSelected: function(column) {
            var $items = this.sandbox.dom.find(&#x27;li&#x27;, &#x27;#column-&#x27; + column);

            this.sandbox.util.each($items, function($el, index) {
                this.sandbox.dom.removeClass($el, &#x27;selected&#x27;);
                var $arrowElement = this.sandbox.dom.find(&#x27;.arrow&#x27;, $el);
                this.sandbox.dom.addClass($arrowElement, &#x27;inactive&#x27;);
            }.bind(this));
        },

        /**
         * Emits an add event
         */
        addNode: function() {
            var parent = this.selected[this.lastHoveredColumn - 1] || null;
            this.sandbox.emit(ADD, parent);
        },

        /**
         * Emits an edit event
         * @param {Object} event
         */
        editNode: function(event) {
            var $listItem, id, item, column;

            if (this.sandbox.dom.hasClass(event.currentTarget, &#x27;edit&#x27;) === true) {
                $listItem = this.sandbox.dom.parent(this.sandbox.dom.parent(event.currentTarget));
            } else {
                $listItem = this.sandbox.dom.$(event.currentTarget);
            }
            column = this.sandbox.dom.index(this.sandbox.dom.parents(event.currentTarget, &#x27;.column&#x27;));
            id = this.sandbox.dom.data($listItem, &#x27;id&#x27;);
            item = this.columns[column][id];

            this.sandbox.dom.stopPropagation(event);
            this.sandbox.emit(EDIT, item);
        },

        /**
         * Templates for various parts
         */
        template: {

            wrapper: function() {
                return &#x27;&lt;div class=&quot;column-navigation-wrapper&quot;&gt;&lt;/div&gt;&#x27;;
            },

            columnContainer: function() {
                return [&#x27;&lt;div class=&quot;column-navigation&quot;&gt;&lt;/div&gt;&#x27;].join(&#x27;&#x27;);
            },

            column: function(columnNumber, width) {
                return [&#x27;&lt;div data-column=&quot;&#x27;, columnNumber, &#x27;&quot; class=&quot;column&quot; id=&quot;column-&#x27;, columnNumber, &#x27;&quot; style=&quot;width: &#x27;, width, &#x27;px&quot;&gt;&lt;ul&gt;&lt;/ul&gt;&lt;/div&gt;&#x27;].join(&#x27;&#x27;);
            },

            noPage: function(description) {
                return [&#x27;&lt;div class=&quot;no-page&quot;&gt;&#x27;,
                    &#x27;&lt;span class=&quot;fa-file-o&quot;&gt;&lt;/span&gt;&#x27;,
                    &#x27;&lt;div class=&quot;text&quot;&gt;&#x27;, description , &#x27;&lt;/div&gt;&#x27;,
                    &#x27;&lt;/div&gt;&#x27;].join(&#x27;&#x27;);
            },

            item: function(width, data) {

                var item = [&#x27;&lt;li data-id=&quot;&#x27;, data[this.options.idName], &#x27;&quot; class=&quot;pointer&quot;&gt;&#x27;];

                if (!!this.options.showStatus) {
                    // icons left
                    item.push(&#x27;&lt;span class=&quot;icons-left&quot;&gt;&#x27;);
                    // link
                    if (!!data[this.options.linkedName]) {
                        if (data[this.options.linkedName] === &#x27;internal&#x27;) {
                            item.push(&#x27;&lt;span class=&quot;fa-internal-link pull-left m-right-5&quot;&gt;&lt;/span&gt;&#x27;);
                        } else if (data[this.options.linkedName] === &#x27;external&#x27;) {
                            item.push(&#x27;&lt;span class=&quot;fa-external-link pull-left m-right-5&quot;&gt;&lt;/span&gt;&#x27;);
                        }
                    }

                    // type (ghost, shadow)
                    if (!!data[this.options.typeName]) {
                        if (data[this.options.typeName].name === &#x27;ghost&#x27;) {
                            item.push(&#x27;&lt;span class=&quot;ghost pull-left m-right-5&quot;&gt;&#x27;, data[this.options.typeName].value, &#x27;&lt;/span&gt;&#x27;);
                        } else if (data[this.options.typeName].name === &#x27;shadow&#x27;) {
                            item.push(&#x27;&lt;span class=&quot;fa-shadow-node pull-left m-right-5&quot;&gt;&lt;/span&gt;&#x27;);
                        }
                    }

                    // published
                    if (!data[this.options.publishedName]) {
                        item.push(&#x27;&lt;span class=&quot;not-published pull-left m-right-5&quot;&gt;&amp;bull;&lt;/span&gt;&#x27;);
                    }
                }
                item.push(&#x27;&lt;/span&gt;&#x27;);

                // text center
                if (!!data[this.options.typeName] &amp;&amp; data[this.options.typeName].name === &#x27;ghost&#x27;) {
                    item.push(&#x27;&lt;span title=&quot;&#x27; + data[this.options.titleName] + &#x27;&quot; class=&quot;item-text inactive pull-left&quot;&gt;&#x27;, data[this.options.titleName], &#x27;&lt;/span&gt;&#x27;);
                } else {
                    item.push(&#x27;&lt;span title=&quot;&#x27; + data[this.options.titleName] + &#x27;&quot; class=&quot;item-text pull-left&quot;&gt;&#x27;, data[this.options.titleName], &#x27;&lt;/span&gt;&#x27;);
                }

                // icons right (subpage, edit)
                item.push(&#x27;&lt;span class=&quot;icons-right&quot;&gt;&#x27;);
                if (!!this.options.showEditIcon) {
                    item.push(&#x27;&lt;span class=&quot;&#x27; + this.options.editIcon + &#x27; edit hidden pull-left&quot;&gt;&lt;/span&gt;&#x27;);
                }
                !!data[this.options.hasSubName] ? item.push(&#x27;&lt;span class=&quot;fa-chevron-right arrow inactive pull-left&quot;&gt;&lt;/span&gt;&#x27;) : &#x27;&#x27;;
                item.push(&#x27;&lt;/span&gt;&lt;/li&gt;&#x27;);
                return item.join(&#x27;&#x27;);
            },

            optionsContainer: function(width) {
                return [&#x27;&lt;div class=&quot;options grid-row&quot; style=&quot;width:&#x27;, width + 1, &#x27;px&quot;&gt;&lt;/div&gt;&#x27;].join(&#x27;&#x27;);
            },

            options: {
                add: function(id) {
                    return [&#x27;&lt;div id=&quot;&#x27;, id, &#x27;&quot; class=&quot;align-center add pointer&quot;&gt;&#x27;,
                        &#x27;&lt;span class=&quot;fa-plus-circle&quot;&gt;&lt;/span&gt;&#x27;,
                        &#x27;&lt;/div&gt;&#x27;].join(&#x27;&#x27;);
                },

                settings: function(id) {
                    return [&#x27;&lt;div id=&quot;&#x27;, id, &#x27;&quot; class=&quot;align-center settings pointer drop-down-trigger&quot;&gt;&#x27;,
                        &#x27;&lt;span class=&quot;fa-gear inline-block&quot;&gt;&lt;/span&gt;&lt;span class=&quot;dropdown-toggle inline-block&quot;&gt;&lt;/span&gt;&#x27;,
                        &#x27;&lt;/div&gt;&#x27;].join(&#x27;&#x27;);
                }
            }
        }
    };
});


    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
